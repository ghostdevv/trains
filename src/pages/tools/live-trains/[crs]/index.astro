---
import type { LiveTimes } from '$lib/types/liveTimes.d.ts';
import TimeTable from '$lib/time-table/TimeTable.astro';
import { findByCRS } from '$lib/data/stations';
import Global from '$layouts/Global.astro';
import { rtt } from '$lib/rtt';

const station = findByCRS(Astro.params.crs!);

if (!station) {
   	return Astro.redirect('/tools/live-trains?error=rtt-station-not-found');
}

const data = await rtt<LiveTimes>(`/search/${station.crs}`);

if (!data || !data.location) {
	return Astro.redirect(
		`/tools/live-trains?error=${data?.status == 404 ? 'rtt-station-not-found' : 'unhandled'}`,
	);
}
---

<Global>
	<TimeTable times={data} />
</Global>
